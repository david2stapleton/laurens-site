<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site Admin — Lauren Sutherland</title>
</head>
<body>
  <script src="https://unpkg.com/@sveltia/cms/dist/sveltia-cms.js"></script>
  <script>
    // Font pairing preview: inject live sample below the font_pairing field
    (function () {
      var FONTS = {
        'droid-opensans': { heading: "'Droid Serif', Georgia, serif", body: "'Open Sans', Arial, sans-serif", url: 'https://fonts.googleapis.com/css2?family=Droid+Serif:wght@400;700&family=Open+Sans:wght@300;400;600&display=swap' },
        'playfair-lato': { heading: "'Playfair Display', Georgia, serif", body: "'Lato', Arial, sans-serif", url: 'https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Lato:wght@300;400;700&display=swap' },
        'cormorant-raleway': { heading: "'Cormorant Garamond', Georgia, serif", body: "'Raleway', Arial, sans-serif", url: 'https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Raleway:wght@300;400;600&display=swap' },
        'baskerville-sourcesans': { heading: "'Libre Baskerville', Georgia, serif", body: "'Source Sans 3', Arial, sans-serif", url: 'https://fonts.googleapis.com/css2?family=Libre+Baskerville:wght@400;700&family=Source+Sans+3:wght@300;400;600&display=swap' },
        'dmserif-dmsans': { heading: "'DM Serif Display', Georgia, serif", body: "'DM Sans', Arial, sans-serif", url: 'https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;700&display=swap' }
      };

      var PAIRING_KEYS = Object.keys(FONTS);

      // Preload all font families
      Object.values(FONTS).forEach(function (f) {
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = f.url;
        document.head.appendChild(link);
      });

      function createPreview() {
        var el = document.createElement('div');
        el.id = 'font-preview';
        el.style.cssText = 'margin-top:12px;padding:16px;border:1px solid #ddd;border-radius:6px;background:#fafafa;';
        el.innerHTML = '<div style="margin-bottom:4px;font-size:24px;font-weight:700;" id="fp-heading">Heading Preview</div>'
          + '<div style="font-size:16px;font-weight:300;" id="fp-body">Body text preview — the quick brown fox jumps over the lazy dog.</div>';
        return el;
      }

      function updatePreview(key) {
        var font = FONTS[key];
        if (!font) return;
        var h = document.getElementById('fp-heading');
        var b = document.getElementById('fp-body');
        if (h) h.style.fontFamily = font.heading;
        if (b) b.style.fontFamily = font.body;
      }

      // Detect the current font pairing value from any element type
      function detectValue(fieldEl) {
        // Native <select>
        var sel = fieldEl.querySelector('select');
        if (sel) return sel.value;
        // Sveltia custom select: look for a button or span showing the selected label,
        // or a hidden input, or an element with a data-value attribute
        var hidden = fieldEl.querySelector('input[type="hidden"]');
        if (hidden && hidden.value) return hidden.value;
        // Check for listbox option with aria-selected
        var selected = fieldEl.querySelector('[role="option"][aria-selected="true"]');
        if (selected) {
          var val = selected.getAttribute('data-value') || selected.textContent.trim();
          // If it's a label like "Droid Serif + Open Sans (Classic)", match to key
          return matchLabelToKey(val) || val;
        }
        // Check button text or displayed value
        var btn = fieldEl.querySelector('button, [role="combobox"]');
        if (btn) return matchLabelToKey(btn.textContent.trim());
        return null;
      }

      var LABEL_MAP = {
        'droid serif': 'droid-opensans',
        'playfair': 'playfair-lato',
        'cormorant': 'cormorant-raleway',
        'baskerville': 'baskerville-sourcesans',
        'dm serif': 'dmserif-dmsans'
      };

      function matchLabelToKey(text) {
        if (!text) return null;
        var lower = text.toLowerCase();
        // Direct key match
        if (FONTS[lower]) return lower;
        // Partial label match
        for (var fragment in LABEL_MAP) {
          if (lower.indexOf(fragment) !== -1) return LABEL_MAP[fragment];
        }
        return null;
      }

      // Find the font_pairing field wrapper by looking for a label containing "Font Pairing"
      function findFontField() {
        var labels = document.querySelectorAll('label, legend, [class*="label"], [class*="Label"]');
        for (var i = 0; i < labels.length; i++) {
          if (labels[i].textContent.trim().indexOf('Font Pairing') !== -1) {
            // Walk up to the field wrapper
            var field = labels[i].closest('[class*="field"], [class*="Field"], [data-field], fieldset')
              || labels[i].parentElement;
            return field;
          }
        }
        return null;
      }

      function tryInject() {
        if (document.getElementById('font-preview')) return;
        var field = findFontField();
        if (!field) return;

        var preview = createPreview();
        field.appendChild(preview);

        var val = detectValue(field);
        if (val) updatePreview(val);

        // Watch for changes in the field subtree
        new MutationObserver(function () {
          var v = detectValue(field);
          if (v) updatePreview(v);
        }).observe(field, { subtree: true, childList: true, attributes: true, characterData: true });
      }

      // Use MutationObserver on body to react to CMS navigation/rendering
      new MutationObserver(function () {
        // If preview was removed (CMS navigated away), allow re-injection
        tryInject();
      }).observe(document.body, { subtree: true, childList: true });
    })();
  </script>
</body>
</html>
