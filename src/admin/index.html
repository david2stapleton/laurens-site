<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Site Admin — Lauren Sutherland</title>
</head>
<body>
  <script src="https://unpkg.com/@sveltia/cms/dist/sveltia-cms.js"></script>
  <script>
    // Font pairing preview: inject live sample below the font_pairing field
    (function () {
      var FONTS = {
        'droid-opensans': { heading: "'Droid Serif', Georgia, serif", body: "'Open Sans', Arial, sans-serif" },
        'playfair-lato': { heading: "'Playfair Display', Georgia, serif", body: "'Lato', Arial, sans-serif" },
        'cormorant-raleway': { heading: "'Cormorant Garamond', Georgia, serif", body: "'Raleway', Arial, sans-serif" },
        'baskerville-sourcesans': { heading: "'Libre Baskerville', Georgia, serif", body: "'Source Sans 3', Arial, sans-serif" },
        'dmserif-dmsans': { heading: "'DM Serif Display', Georgia, serif", body: "'DM Sans', Arial, sans-serif" }
      };

      // Preload all font families
      var fontLink = document.createElement('link');
      fontLink.rel = 'stylesheet';
      fontLink.href = 'https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=DM+Sans:wght@300;400;500;700&family=DM+Serif+Display&family=Droid+Serif:ital,wght@0,400;0,700;1,400&family=Lato:wght@300;400;700&family=Libre+Baskerville:wght@400;700&family=Open+Sans:wght@300;400;600&family=Playfair+Display:wght@400;700&family=Raleway:wght@300;400;600&family=Source+Sans+3:wght@300;400;600&display=swap';
      document.head.appendChild(fontLink);

      function updatePreview(key) {
        var font = FONTS[key];
        if (!font) return;
        var h = document.getElementById('fp-heading');
        var b = document.getElementById('fp-body');
        if (h) h.style.fontFamily = font.heading;
        if (b) b.style.fontFamily = font.body;
      }

      // Detect current value from the field section
      // Sveltia may render as: native radio, ARIA radio, combobox, or native select
      function detectValue(section) {
        // Native radio
        var checked = section.querySelector('input[type="radio"]:checked');
        if (checked) return checked.value;
        // ARIA radio (custom Svelte component)
        var ariaChecked = section.querySelector('[role="radio"][aria-checked="true"]');
        if (ariaChecked) {
          var val = ariaChecked.getAttribute('data-value') || ariaChecked.querySelector('input')?.value;
          if (val) return val;
          return matchLabel(ariaChecked.textContent.trim());
        }
        // Combobox
        var combobox = section.querySelector('[role="combobox"]');
        if (combobox) return matchLabel(combobox.textContent.trim());
        // Native select
        var sel = section.querySelector('select');
        if (sel) return sel.value;
        return null;
      }

      var LABEL_MAP = {
        'droid serif': 'droid-opensans',
        'playfair': 'playfair-lato',
        'cormorant': 'cormorant-raleway',
        'baskerville': 'baskerville-sourcesans',
        'dm serif': 'dmserif-dmsans'
      };

      function matchLabel(text) {
        if (!text) return null;
        var lower = text.toLowerCase();
        if (FONTS[lower]) return lower;
        for (var frag in LABEL_MAP) {
          if (lower.indexOf(frag) !== -1) return LABEL_MAP[frag];
        }
        return null;
      }

      var injected = false;

      function tryInject() {
        if (document.getElementById('font-preview')) { injected = true; return; }
        injected = false;

        // Sveltia wraps each field in: <section class="field" data-key-path="font_pairing">
        var section = document.querySelector('section[data-key-path="font_pairing"]');
        if (!section) return;

        var preview = document.createElement('div');
        preview.id = 'font-preview';
        preview.style.cssText = 'margin-top:12px;padding:16px;border:1px solid #ddd;border-radius:6px;background:#fafafa;';
        preview.innerHTML = '<div style="margin-bottom:4px;font-size:24px;font-weight:700;" id="fp-heading">Heading Preview</div>'
          + '<div style="font-size:16px;font-weight:300;" id="fp-body">Body text preview — the quick brown fox jumps over the lazy dog.</div>';
        section.appendChild(preview);
        injected = true;

        var val = detectValue(section);
        if (val) updatePreview(val);

        // Watch for value changes (any DOM/attribute change in the field)
        new MutationObserver(function () {
          var v = detectValue(section);
          if (v) updatePreview(v);
        }).observe(section, { subtree: true, childList: true, attributes: true });

        // Also listen for click/change events (radio buttons)
        section.addEventListener('change', function () {
          var v = detectValue(section);
          if (v) updatePreview(v);
        });
        section.addEventListener('click', function () {
          setTimeout(function () {
            var v = detectValue(section);
            if (v) updatePreview(v);
          }, 50);
        });
      }

      // Watch for CMS rendering / navigation
      new MutationObserver(function () {
        tryInject();
      }).observe(document.body, { subtree: true, childList: true });
    })();
  </script>
</body>
</html>
